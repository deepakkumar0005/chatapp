<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatApp - Modern Messaging</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #e94560;
            --accent-secondary: #0f3460;
            --background: #0f0f23;
            --surface: #1a1a2e;
            --surface-hover: #252542;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --success: #00d9a5;
            --online: #00d9a5;
            --offline: #6b7280;
            --border: rgba(255, 255, 255, 0.08);
            --shadow: 0 4px 20px rgba(233, 69, 96, 0.1);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-full: 20px;
            --transition: 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; font-family: 'DM Sans', sans-serif; background: var(--background); color: var(--text-primary); overflow: hidden; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Outfit', sans-serif; font-weight: 600; }
        .hidden { display: none !important; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--accent-secondary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
        .login-container { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: var(--background); z-index: 1000; }
        .login-bg { position: absolute; inset: 0; overflow: hidden; }
        .floating-shape { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 20s infinite; }
        .shape-1 { width: 400px; height: 400px; background: var(--accent); top: -100px; left: -100px; animation-delay: 0s; }
        .shape-2 { width: 300px; height: 300px; background: var(--accent-secondary); bottom: -50px; right: -50px; animation-delay: -5s; }
        .shape-3 { width: 200px; height: 200px; background: var(--success); top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: -10s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(50px, 50px) scale(1.1); } 50% { transform: translate(0, 100px) scale(0.9); } 75% { transform: translate(-50px, 50px) scale(1.05); } }
        .login-card { position: relative; background: rgba(26, 26, 46, 0.8); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: var(--radius); padding: 48px; width: 100%; max-width: 420px; box-shadow: var(--shadow); animation: slideUp 0.6s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .logo { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px; }
        .logo-icon { width: 48px; height: 48px; }
        .logo-icon svg { width: 100%; height: 100%; }
        .logo h1 { font-size: 32px; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .tagline { text-align: center; color: var(--text-secondary); margin-bottom: 32px; font-size: 14px; }
        .login-form { display: flex; flex-direction: column; gap: 20px; }
        .input-group { position: relative; }
        .input-group input { width: 100%; padding: 16px 20px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-full); color: var(--text-primary); font-size: 14px; outline: none; transition: var(--transition); }
        .input-group input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1); }
        .input-group label { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 14px; pointer-events: none; transition: var(--transition); }
        .input-group input:focus + label, .input-group input:not(:placeholder-shown) + label { top: 0; left: 16px; font-size: 11px; background: var(--surface); padding: 0 8px; color: var(--accent); }
        .login-btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 16px; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); border: none; border-radius: var(--radius-full); color: var(--text-primary); font-size: 16px; font-weight: 600; cursor: pointer; transition: var(--transition); }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(233, 69, 96, 0.3); }
        .login-btn svg { width: 20px; height: 20px; }
        .error-msg { color: var(--accent); font-size: 13px; text-align: center; min-height: 20px; }
        .hint { text-align: center; color: var(--text-secondary); font-size: 12px; margin-top: 24px; }
        .app-container { display: flex; height: 100vh; background: var(--background); }
        .sidebar { width: 320px; background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; animation: slideInLeft 0.4s ease; }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        .sidebar-header { padding: 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .user-profile { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; position: relative; flex-shrink: 0; }
        .group-avatar { background: var(--accent-secondary); font-size: 18px; }
        .online-indicator { position: absolute; bottom: 2px; right: 2px; width: 12px; height: 12px; background: var(--online); border: 2px solid var(--surface); border-radius: 50%; }
        .user-info h3 { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .user-info span { font-size: 12px; color: var(--success); }
        .icon-btn { width: 40px; height: 40px; border-radius: var(--radius-sm); background: transparent; border: none; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .icon-btn:hover { background: var(--surface-hover); color: var(--accent); }
        .icon-btn svg { width: 20px; height: 20px; }
        .sidebar-actions { padding: 16px 20px; display: flex; gap: 10px; }
        .action-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px; background: var(--surface-hover); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text-primary); font-size: 13px; cursor: pointer; transition: var(--transition); }
        .action-btn:hover { background: var(--accent); border-color: var(--accent); }
        .action-btn svg { width: 18px; height: 18px; }
        .chats-list { flex: 1; overflow-y: auto; padding: 0 12px; }
        .list-header { padding: 12px 8px; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 0.5px; }
        .chats-container { display: flex; flex-direction: column; gap: 4px; }
        .chat-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition); }
        .chat-item:hover { background: var(--surface-hover); }
        .chat-item.active { background: var(--surface-hover); border-left: 3px solid var(--accent); }
        .chat-item .avatar { width: 40px; height: 40px; font-size: 14px; }
        .chat-item-info { flex: 1; min-width: 0; }
        .chat-item-info h4 { font-size: 14px; font-weight: 500; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-item-info p { font-size: 12px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .admin-link { padding: 12px 20px; border-top: 1px solid var(--border); }
        .admin-btn { width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); border: none; border-radius: var(--radius-sm); color: var(--text-primary); font-size: 13px; font-weight: 600; cursor: pointer; transition: var(--transition); }
        .admin-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3); }
        .admin-btn svg { width: 18px; height: 18px; }
        .sidebar-footer { padding: 16px 20px; border-top: 1px solid var(--border); }
        .logout-btn { width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px; background: transparent; border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: var(--transition); }
        .logout-btn:hover { background: rgba(233, 69, 96, 0.1); border-color: var(--accent); color: var(--accent); }
        .logout-btn svg { width: 18px; height: 18px; }
        .chat-area { flex: 1; display: flex; flex-direction: column; background: var(--background); }
        .welcome-screen { flex: 1; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .welcome-content { text-align: center; }
        .welcome-icon { width: 120px; height: 120px; margin: 0 auto 24px; background: var(--surface); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(233, 69, 96, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(233, 69, 96, 0.2); } }
        .welcome-icon svg { width: 60px; height: 60px; }
        .welcome-content h2 { font-size: 24px; margin-bottom: 8px; }
        .welcome-content p { color: var(--text-secondary); }
        .chat-container { flex: 1; display: flex; flex-direction: column; animation: slideInRight 0.4s ease; }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
        .chat-header { padding: 16px 24px; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .chat-header-info { display: flex; align-items: center; gap: 12px; }
        .chat-header-info .avatar { width: 40px; height: 40px; }
        .chat-details h3 { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
        .chat-details span { font-size: 12px; color: var(--text-secondary); }
        .chat-actions { display: flex; gap: 8px; }
        .messages-container { flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 16px; }
        .message { display: flex; flex-direction: column; max-width: 70%; animation: messageIn 0.3s ease; }
        @keyframes messageIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.sent { align-self: flex-end; }
        .message.received { align-self: flex-start; }
        .message-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .message.sent .message-header { flex-direction: row-reverse; }
        .message-sender { font-size: 12px; font-weight: 600; color: var(--accent); }
        .message-time { font-size: 10px; color: var(--text-secondary); }
        .message-bubble { padding: 12px 16px; border-radius: var(--radius); font-size: 14px; line-height: 1.5; word-wrap: break-word; }
        .message.sent .message-bubble { background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); border-bottom-right-radius: 4px; }
        .message.received .message-bubble { background: var(--surface); border-bottom-left-radius: 4px; }
        .message-input-container { padding: 16px 24px; background: var(--surface); border-top: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .message-input-container input { flex: 1; padding: 14px 20px; background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-full); color: var(--text-primary); font-size: 14px; outline: none; transition: var(--transition); }
        .message-input-container input:focus { border-color: var(--accent); }
        .message-input-container input::placeholder { color: var(--text-secondary); }
        .send-btn { width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); border: none; color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .send-btn:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3); }
        .send-btn svg { width: 20px; height: 20px; }
        .modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 2000; animation: fadeIn 0.2s ease; }
        .modal-content { background: var(--surface); border-radius: var(--radius); width: 100%; max-width: 480px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column; animation: modalIn 0.3s ease; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .modal-header h3 { font-size: 18px; }
        .close-modal { width: 32px; height: 32px; border-radius: 50%; background: transparent; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .close-modal:hover { background: var(--surface-hover); color: var(--text-primary); }
        .modal-body { padding: 24px; overflow-y: auto; }
        .modal-body p { color: var(--text-secondary); margin-bottom: 16px; font-size: 14px; }
        .users-list { display: flex; flex-direction: column; gap: 8px; max-height: 300px; overflow-y: auto; }
        .user-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition); }
        .user-item:hover { background: var(--surface-hover); }
        .user-item .avatar { width: 36px; height: 36px; font-size: 14px; }
        .user-item-info h4 { font-size: 14px; font-weight: 500; margin-bottom: 2px; }
        .user-item-info span { font-size: 12px; color: var(--text-secondary); }
        .submit-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); border: none; border-radius: var(--radius-sm); color: var(--text-primary); font-size: 14px; font-weight: 600; cursor: pointer; transition: var(--transition); margin-top: 20px; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3); }
        @media (max-width: 768px) { .sidebar { position: fixed; left: -100%; top: 0; bottom: 0; width: 100%; max-width: 320px; z-index: 100; transition: var(--transition); } .sidebar.open { left: 0; } .chat-item { padding: 10px; } .messages-container { padding: 16px; } .message { max-width: 85%; } }
    </style>
</head>
<body>
    <div id="login-screen" class="login-container">
        <div class="login-bg">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
        </div>
        <div class="login-card">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l6-4 6 4V4c0-1.1-.9-2-2-2z" fill="url(#g)"/><defs><linearGradient id="g" x1="2" y1="2" x2="22" y2="22"><stop stop-color="#e94560"/><stop offset="1" stop-color="#0f3460"/></linearGradient></defs></svg>
                </div>
                <h1>ChatApp</h1>
            </div>
            <p class="tagline">Connect with friends instantly</p>
            <div class="login-form">
                <div class="input-group"><input type="text" id="username" placeholder=" " required><label for="username">Your Name</label></div>
                <div class="input-group"><input type="password" id="password" placeholder=" " required><label for="password">Password</label></div>
                <button id="login-btn" class="login-btn"><span>Enter Chat</span><svg viewBox="0 0 24 24" fill="none"><path d="M2 21l21-9-21-6v4l13 2-13 2v4z" fill="currentColor"/></svg></button>
                <p id="login-error" class="error-msg"></p>
            </div>
            <p class="hint">Password: chat123 | Admin: use "admin" as name</p>
        </div>
    </div>
    <div id="app" class="app-container hidden">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar"><span id="current-user-avatar">U</span><div class="online-indicator"></div></div>
                    <div class="user-info"><h3 id="current-user-name">User</h3><span>Online</span></div>
                </div>
                <button id="menu-toggle" class="icon-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg></button>
            </div>
            <div class="sidebar-actions">
                <button id="new-chat-btn" class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg><span>New Chat</span></button>
                <button id="create-group-btn" class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg><span>Create Group</span></button>
            </div>
            <div class="chats-list"><div class="list-header"><span>Conversations</span></div><div id="chats-container" class="chats-container"></div></div>
            <div id="admin-panel-link" class="admin-link hidden"><button id="admin-btn" class="admin-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg><span>Admin Panel</span></button></div>
            <div class="sidebar-footer"><button id="logout-btn" class="logout-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>Logout</span></button></div>
        </aside>
        <main class="chat-area">
            <div id="welcome-screen" class="welcome-screen"><div class="welcome-content"><div class="welcome-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#e94560" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></div><h2>Welcome to ChatApp</h2><p>Select a conversation to start messaging</p></div></div>
            <div id="chat-container" class="chat-container hidden">
                <div class="chat-header"><div class="chat-header-info"><div class="avatar group-avatar" id="chat-avatar"><span>#</span></div><div class="chat-details"><h3 id="chat-name">Chat Name</h3><span id="chat-status">Click to view info</span></div></div><div class="chat-actions"><button class="icon-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button></div></div>
                <div id="messages-container" class="messages-container"></div>
                <div class="message-input-container"><input type="text" id="message-input" placeholder="Type a message..."><button id="send-btn" class="send-btn"><svg viewBox="0 0 24 24" fill="none"><path d="M2 21l21-9-21-6v4l13 2-13 2v4z" fill="currentColor"/></svg></button></div>
            </div>
        </main>
    </div>
    <div id="new-chat-modal" class="modal hidden"><div class="modal-content"><div class="modal-header"><h3>New Chat</h3><button class="close-modal">&times;</button></div><div class="modal-body"><p>Select a user to start a conversation</p><div id="users-list" class="users-list"></div></div></div></div>
    <div id="create-group-modal" class="modal hidden"><div class="modal-content"><div class="modal-header"><h3>Create Group</h3><button class="close-modal">&times;</button></div><div class="modal-body"><div class="input-group"><input type="text" id="group-name" placeholder=" " required><label for="group-name">Group Name</label></div><button id="create-group-submit" class="submit-btn">Create Group</button></div></div></div>
    <div id="admin-modal" class="modal hidden"><div class="modal-content" style="max-width:600px"><div class="modal-header"><h3>Admin Panel</h3><button class="close-modal">&times;</button></div><div class="modal-body"><p>Welcome to Admin Panel</p></div></div></div>
    <script>
        const CONFIG = { PASSWORD: 'chat123', ADMIN_NAME: 'admin' };
        let currentUser = null, currentChat = null, users = [], chats = [], messages = {};
        const loginScreen = document.getElementById('login-screen'), app = document.getElementById('app'), loginBtn = document.getElementById('login-btn'), usernameInput = document.getElementById('username'), passwordInput = document.getElementById('password'), loginError = document.getElementById('login-error'), currentUserAvatar = document.getElementById('current-user-avatar'), currentUserName = document.getElementById('current-user-name'), chatsContainer = document.getElementById('chats-container'), welcomeScreen = document.getElementById('welcome-screen'), chatContainer = document.getElementById('chat-container'), chatName = document.getElementById('chat-name'), chatAvatar = document.getElementById('chat-avatar'), chatStatus = document.getElementById('chat-status'), messagesContainer = document.getElementById('messages-container'), messageInput = document.getElementById('message-input'), sendBtn = document.getElementById('send-btn'), newChatBtn = document.getElementById('new-chat-btn'), createGroupBtn = document.getElementById('create-group-btn'), adminBtn = document.getElementById('admin-btn'), logoutBtn = document.getElementById('logout-btn'), menuToggle = document.getElementById('menu-toggle'), sidebar = document.querySelector('.sidebar'), newChatModal = document.getElementById('new-chat-modal'), createGroupModal = document.getElementById('create-group-modal'), adminModal = document.getElementById('admin-modal'), usersList = document.getElementById('users-list'), groupNameInput = document.getElementById('group-name'), createGroupSubmit = document.getElementById('create-group-submit'), adminPanelLink = document.getElementById('admin-panel-link');
        function initDemoData() {
            users = [{ id: '1', username: 'Alice', online: true }, { id: '2', username: 'Bob', online: true }, { id: '3', username: 'Charlie', online: false }];
            chats = [{ id: 'general', name: 'General', type: 'group', members: ['1', '2', '3'] }];
            messages = { general: [{ id: '1', chatId: 'general', senderId: '1', senderName: 'Alice', message: 'Welcome to ChatApp!', timestamp: new Date().toISOString() }] };
            saveData();
        }
        function loadData() {
            const savedUser = localStorage.getItem('chatapp_user'), savedUsers = localStorage.getItem('chatapp_users'), savedChats = localStorage.getItem('chatapp_chats'), savedMessages = localStorage.getItem('chatapp_messages');
            if (savedUser) { currentUser = JSON.parse(savedUser); users = savedUsers ? JSON.parse(savedUsers) : []; chats = savedChats ? JSON.parse(savedChats) : []; messages = savedMessages ? JSON.parse(savedMessages) : {}; showApp(); } else { initDemoData(); }
        }
        function saveData() { localStorage.setItem('chatapp_users', JSON.stringify(users)); localStorage.setItem('chatapp_chats', JSON.stringify(chats)); localStorage.setItem('chatapp_messages', JSON.stringify(messages)); }
        loginBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim(), password = passwordInput.value.trim();
            if (!username || !password) { loginError.textContent = 'Please enter both name and password'; return; }
            if (password !== CONFIG.PASSWORD) { loginError.textContent = 'Invalid password'; return; }
            currentUser = { id: Date.now().toString(), username: username, isAdmin: username.toLowerCase() === CONFIG.ADMIN_NAME, online: true };
            if (!users.find(u => u.id === currentUser.id)) users.push(currentUser);
            const generalChat = chats.find(c => c.id === 'general');
            if (generalChat && !generalChat.members.includes(currentUser.id)) generalChat.members.push(currentUser.id);
            localStorage.setItem('chatapp_user', JSON.stringify(currentUser));
            saveData();
            showApp();
        });
        function showApp() { loginScreen.classList.add('hidden'); app.classList.remove('hidden'); currentUserAvatar.textContent = currentUser.username.charAt(0).toUpperCase(); currentUserName.textContent = currentUser.username; if (currentUser.isAdmin) adminPanelLink.classList.remove('hidden'); renderChats(); }
        function renderChats() {
            chatsContainer.innerHTML = '';
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.dataset.chatId = chat.id;
                const chatMessages = messages[chat.id] || [], lastMessage = chatMessages.slice(-1)[0], lastMessageText = lastMessage ? lastMessage.message : 'No messages yet', initial = chat.type === 'group' ? '#' : chat.name.charAt(0).toUpperCase();
                chatItem.innerHTML = '<div class="avatar ' + (chat.type === 'group' ? 'group-avatar' : '') + '"><span>' + initial + '</span></div><div class="chat-item-info"><h4>' + chat.name + '</h4><p>' + lastMessageText.substring(0, 30) + (lastMessageText.length > 30 ? '...' : '') + '</p></div>';
                chatItem.addEventListener('click', function() { selectChat(chat); });
                chatsContainer.appendChild(chatItem);
            });
        }
        function selectChat(chat) {
            currentChat = chat;
            document.querySelectorAll('.chat-item').forEach(function(item) { item.classList.remove('active'); if (item.dataset.chatId === chat.id) item.classList.add('active'); });
            welcomeScreen.classList.add('hidden');
            chatContainer.classList.remove('hidden');
            chatName.textContent = chat.name;
            chatAvatar.innerHTML = '<span>' + (chat.type === 'group' ? '#' : chat.name.charAt(0).toUpperCase()) + '</span>';
            chatStatus.textContent = chat.type === 'group' ? (chat.members ? chat.members.length : 0) + ' members' : 'Online';
            renderMessages();
        }
        function renderMessages() {
            if (!currentChat) return;
            var chatMessages = messages[currentChat.id] || [];
            messagesContainer.innerHTML = '';
            chatMessages.forEach(function(msg) { addMessageToUI(msg); });
            scrollToBottom();
        }
        function addMessageToUI(msg) {
            var isSent = msg.senderId === currentUser.id;
            var messageEl = document.createElement('div');
            messageEl.className = 'message ' + (isSent ? 'sent' : 'received');
            var time = new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            messageEl.innerHTML = '<div class="message-header"><span class="message-sender">' + msg.senderName + '</span><span class="message-time">' + time + '</span></div><div class="message-bubble">' + msg.message + '</div>';
            messagesContainer.appendChild(messageEl);
        }
        function scrollToBottom() { messagesContainer.scrollTop = messagesContainer.scrollHeight; }
        function sendMessage() {
            var message = messageInput.value.trim();
            if (!message || !currentChat) return;
            var msg = { id: Date.now().toString(), chatId: currentChat.id, senderId: currentUser.id, senderName: currentUser.username, message: message, timestamp: new Date().toISOString() };
            if (!messages[currentChat.id]) messages[currentChat.id] = [];
            messages[currentChat.id].push(msg);
            saveData();
            addMessageToUI(msg);
            scrollToBottom();
            messageInput.value = '';
            renderChats();
        }
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') sendMessage(); });
        newChatBtn.addEventListener('click', function() {
            usersList.innerHTML = '';
            users.filter(function(u) { return u.id !== currentUser.id; }).forEach(function(user) {
                var userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = '<div class="avatar">' + user.username.charAt(0).toUpperCase() + '</div><div class="user-item-info"><h4>' + user.username + '</h4><span>' + (user.online ? 'Online' : 'Offline') + '</span></div>';
                userItem.addEventListener('click', function() { createPrivateChat(user); closeModal(newChatModal); });
                usersList.appendChild(userItem);
            });
            openModal(newChatModal);
        });
        function createPrivateChat(user) {
            var privateChat = chats.find(function(c) { return c.type === 'private' && c.members.includes(currentUser.id) && c.members.includes(user.id); });
            if (!privateChat) { privateChat = { id: 'private_' + Date.now(), name: user.username, type: 'private', members: [currentUser.id, user.id] }; chats.push(privateChat); messages[privateChat.id] = []; saveData(); }
            renderChats();
            selectChat(privateChat);
        }
        createGroupBtn.addEventListener('click', function() { openModal(createGroupModal); });
        createGroupSubmit.addEventListener('click', function() {
            var name = groupNameInput.value.trim();
            if (!name) return;
            var group = { id: 'group_' + Date.now(), name: name, type: 'group', members: [currentUser.id], admin: currentUser.id };
            chats.push(group); messages[group.id] = []; saveData();
            groupNameInput.value = ''; closeModal(createGroupModal); renderChats(); selectChat(group);
        });
        adminBtn.addEventListener('click', function() { openModal(adminModal); });
        function openModal(modal) { modal.classList.remove('hidden'); }
        function closeModal(modal) { modal.classList.add('hidden'); }
        document.querySelectorAll('.modal').forEach(function(modal) { modal.addEventListener('click', function(e) { if (e.target === modal) closeModal(modal); }); });
        document.querySelectorAll('.close-modal').forEach(function(btn) { btn.addEventListener('click', function() { closeModal(newChatModal); closeModal(createGroupModal); closeModal(adminModal); }); });
        menuToggle.addEventListener('click', function() { sidebar.classList.toggle('open'); });
        logoutBtn.addEventListener('click', function() { localStorage.removeItem('chatapp_user'); location.reload(); });
        loadData();
    </script>
</body>
</html>
